<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./IMG/maiscoxinhasem.ico" type="image/x-icon">
    <title>Salgado da Vovó - Comanda</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./CSS/largura.css">
    <link rel="stylesheet" href="./CSS/botao.css">
    <link rel="stylesheet" href="./CSS/header.css">
    <link rel="stylesheet" href="./CSS/pedido.css">
    <link rel="stylesheet" href="./CSS/teste.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .logo:hover {
            opacity: 0.8;
        }

        #comentarios {
            background-color: #ffd000;
            border-color: #ff6600;
            border: 3px solid;
        }

        #endereco {
            background-color: #ffd000;
            border-color: #ff6600;
            border: 3px solid;
        }

        .item-quantidade {
            background-color: #ffd000;
            border: 2px solid;
        }
    </style>
</head>

<body>

    <header>
        <div class="container">
            <div class="row align-items-center">
                <a href="#" onclick="verificarUsuarioLogado()" class="logo"> <img src="./IMG/Desde-1950v3.png"
                        alt="Voltar para HOME" class="logo" title="Verificar Usuário"> </a>
                <div class="col-md-9 text-start">
                    <h1 class="texto-direita">Salgado da Vovó</h1>
                </div>
            </div>
        </div>
    </header>

    <section id="comanda">
        <h2>Comanda de Pedido</h2>
        <br>
        <div class="toggle-button" onclick="toggleItems()">
            <span id="toggle-symbol">+</span> Selecionar Itens
        </div>
        <div class="item-list" id="item-list">
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="5" onchange="calcularTotal()">
                    <label>Kibe - R$ 5.00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="6" onchange="calcularTotal()">
                    <label>Coxinha de Frango - R$ 6.00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <!-- Novos itens adicionados -->
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="5" onchange="calcularTotal()">
                    <label>Mini Sanduíches de Frango - R$ 5,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="5" onchange="calcularTotal()">
                    <label>Trouxinhas de Frango - R$ 5,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="6" onchange="calcularTotal()">
                    <label>Torta Fria de Salpicão de Frango - R$ 6,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="6" onchange="calcularTotal()">
                    <label>Empada de Frango - R$ 6,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="7" onchange="calcularTotal()">
                    <label>Torta de Frango - R$ 7,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="6" onchange="calcularTotal()">
                    <label>Rabo de Tatu - R$ 6,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="5" onchange="calcularTotal()">
                    <label>Esfirra de Carne - R$ 5,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="5" onchange="calcularTotal()">
                    <label>Esfirra Fechada de Carne - R$ 5,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="7" onchange="calcularTotal()">
                    <label>Pão de Batata - R$ 7,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
            <div class="item-row">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="checkbox" class="item-checkbox" value="5" onchange="calcularTotal()">
                    <label>Buraco Quente - R$ 5,00</label>
                </div>
                <div class="quantidade-wrapper">
                    <input type="number" class="item-quantidade" value="1" min="1" onchange="calcularTotal()" disabled>
                </div>
            </div>
        </div>
        <br>
        <div class="form-group mb-3">
            <label for="endereco" style="font-size: 20px;">Endereço de Entrega:</label>
            <input type="address" class="form-control" id="endereco"
                placeholder="Digite o seu endereço completo"></input>
        </div>

        <div class="form-group mb-3" style="font-size: 17px;">
            <label style="font-size: 20px;">Tipo de Pagamento:</label><br>
            <input type="checkbox" id="checkbox" name="pagamento" value="dinheiro"> Dinheiro Físico<br>
            <input type="checkbox" id="checkbox" name="pagamento" value="debito"> Cartão de Débito<br>
            <input type="checkbox" id="checkbox" name="pagamento" value="credito"> Cartão de Crédito<br>
        </div>

        <div class="form-group mb-3">
            <label for="comentarios" style="font-size: 20px;">Comentários sobre o lanche:</label>
            <textarea class="form-control" id="comentarios" rows="3"
                placeholder="Escreva aqui seus comentários..."></textarea>
        </div>
        <br>
        <h3>Preço Total: R$ <span id="total">0.00</span></h3>
        <br>
        <button class="btn" onclick="enviarComanda()">Enviar Comanda</button>
        <button id="voltar-btn" class="btn btn-danger" onclick="voltar()">Voltar</button>
        <div id="resultado" class="mt-3"></div>
    </section>

    <script>
        function verificarUsuarioLogado() {
            const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
            if (usuarioLogado) {
                window.location.href = 'HomeLOGIN.html';
            }
            else {
                window.location.href = 'Home.html';
            }
        }
        function toggleItems() {
            const itemList = document.getElementById('item-list');
            const toggleSymbol = document.getElementById('toggle-symbol');
            itemList.style.display = itemList.style.display === "block" ? "none" : "block";
            toggleSymbol.innerText = toggleSymbol.innerText === "+" ? "-" : "+";
        }

        function calcularTotal() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            let total = 0;

            checkboxes.forEach((checkbox) => {
                const quantidadeInput = checkbox.closest('.item-row').querySelector('.item-quantidade');
                if (checkbox.checked) {
                    quantidadeInput.disabled = false;
                    const quantidade = parseInt(quantidadeInput.value) || 1;
                    const preco = parseFloat(checkbox.value);
                    total += preco * quantidade;
                } else {
                    quantidadeInput.disabled = true;
                    quantidadeInput.value = 1;
                }
            });

            document.getElementById('total').innerText = ` ${total.toFixed(2)}`;
        }

        function enviarComanda() {
            // Verifica se há um usuário logado no localStorage
            const nomeUsuario = localStorage.getItem('nomeUsuario');
            if (!nomeUsuario) {
                Swal.fire({
                    title: 'Atenção!',
                    text: 'Você precisa estar logado para enviar a comanda.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }

            // O restante do seu código permanece o mesmo
            const checkboxes = document.querySelectorAll('.item-checkbox:checked');
            const endereco = document.getElementById('endereco').value.trim();
            const pagamentosSelecionados = document.querySelectorAll('input[name="pagamento"]:checked');

            if (checkboxes.length === 0) {
                Swal.fire({
                    title: 'Atenção!',
                    text: 'Nenhum item selecionado. Por favor, selecione ao menos um item para enviar a comanda.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }

            if (endereco === "") {
                Swal.fire({
                    title: 'Atenção!',
                    text: 'Por favor, insira um endereço de entrega.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }

            if (pagamentosSelecionados.length === 0) {
                Swal.fire({
                    title: 'Atenção!',
                    text: 'Por favor, selecione um método de pagamento.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }

            let itemsSelecionados = [];
            let total = 0;

            checkboxes.forEach((checkbox) => {
                const quantidadeInput = checkbox.closest('.item-row').querySelector('.item-quantidade');
                const quantidade = parseInt(quantidadeInput.value) || 1;
                const nomeItem = checkbox.nextElementSibling.textContent.trim();
                total += (parseFloat(checkbox.value) * quantidade);

                itemsSelecionados.push(`${nomeItem.padEnd(30)} - Quantidade: ${quantidade}`);
            });

            const comentarios = document.getElementById('comentarios').value;
            const pagamentos = Array.from(pagamentosSelecionados).map(el => el.value).join(', ');

            Swal.fire({
                title: 'Comanda Enviada!',
                html: `
                <strong>Itens:</strong><br>
                ${itemsSelecionados.join('<br>')}
                <br><strong>Endereço:</strong> ${endereco}<br>
                <strong>Pagamento:</strong> ${pagamentos}<br>
                <strong>Comentários:</strong> ${comentarios || 'Nenhum'}<br>
                <strong>Preço Total:</strong> R$ ${total.toFixed(2)}<br>
                `,
                icon: 'success',
                showCancelButton: true,
                confirmButtonText: 'OK',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Obrigado!', 'Sua comanda foi enviada.', 'success');
                } else if (result.isDismissed) {
                    Swal.fire('Cancelado', 'Sua comanda não foi enviada.', 'error');
                }
            });
        }
        function voltar() {
            // Ação para voltar, como redirecionar para outra página
            window.history.back();
        }
    </script>
</body>

</html>